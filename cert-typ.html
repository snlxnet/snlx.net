<!doctype html>
<html>

<head>
    <title>cert-typ</title>
    <link rel="stylesheet" href="/new.css">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="color-scheme" content="light dark">
</head>

<body>
    <nav>
        <h2>Linked Notes</h2>
        <ul>
            <li class="current"><a href="/cert-typ">cert-typ</a></li>
        </ul><a class="source" href="https://github.com/snlxnet/snlx.net"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-github-icon lucide-github">
                <path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"></path>
                <path d="M9 18c-4.51 2-5-2-7-2"></path>
            </svg>Source&nbsp;code</a>
    </nav>
    <main>
        <div class="metadata">
            <div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-feather-icon lucide-feather">
                    <path d="M12.67 19a2 2 0 0 0 1.416-.588l6.154-6.172a6 6 0 0 0-8.49-8.49L5.586 9.914A2 2 0 0 0 5 11.328V18a1 1 0 0 0 1 1z"></path>
                    <path d="M16 8 2 22"></path>
                    <path d="M17.5 15H9"></path>
                </svg>created <span data-date="2025-11-16" class="date">...</span> ago</div>
            <div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-refresh-cw-icon lucide-refresh-cw">
                    <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path>
                    <path d="M21 3v5h-5"></path>
                    <path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path>
                    <path d="M8 16H3v5"></path>
                </svg>updated <span data-date="2026-01-21T23:12:23+03:00" class="date">...</span> ago</div>
            <div class="tag">#project</div>
            <div class="tag">#archive</div>
        </div>
        <pre class="frontmatter language-yaml" style="display: none;"><code class="language-yaml is-loaded"><span class="token key atrule">tags</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> project
  <span class="token punctuation">-</span> archive
<span class="token key atrule">created</span><span class="token punctuation">:</span> <span class="token datetime number">2025-11-16</span>
<span class="token key atrule">updated</span><span class="token punctuation">:</span> <span class="token datetime number">2026-01-21T23:12:23+03:00</span>
<span class="token key atrule">post</span><span class="token punctuation">:</span> <span class="token string">"[[snlx.net]]"</span>
<span class="token key atrule">state</span><span class="token punctuation">:</span> done
<span class="token key atrule">layout</span><span class="token punctuation">:</span> base.njk</code></pre>
        <h2 data-heading="Generating the certificates" dir="auto">Generating the certificates</h2>
        <p dir="auto">In the previous part (see <a data-href="cert-site-start" href="/cert-site-start" class="internal-link">cert-site-start</a>) I've realized that rendering with SVGs was not the best idea and I should've used typst. In this part, I'm adding typst.</p>
        <p dir="auto"><a data-tooltip-position="top" aria-label="https://github.com/Myriad-Dreamin/typst.ts" class="external-link" href="https://github.com/Myriad-Dreamin/typst.ts">typst.ts is a project</a> that allows running the compiler in JS without building my own Rust part. It feels like half of its documentation is in the typescript definition files though. I need a function to add an image so that I can then include it in the typst document. The only method I've found that <em>could</em> do it is <code>addSource</code>, though I was looking for something like <code>addFile</code>, not <code>addSource</code>. IIRC <code>source</code> files are represented as text?</p>
        <p dir="auto">It's 2 days later and I haven't figured out how to read additional sources, nor did I find any docs on it. Maybe they do exist, but I couldn't find them. Anyway, I'll make my own simple wrapper on top of typst. I'm going to base my thing off the <a data-tooltip-position="top" aria-label="https://crates.io/crates/typst-as-lib" class="external-link" href="https://crates.io/crates/typst-as-lib">typst-as-lib crate</a> because it should have a minimal <code>World</code>. I'm going to call the new repo <code>typ-js</code>.</p>
        <p dir="auto">It's been half a week, I've returned to this project and it no longer works. <a data-tooltip-position="top" aria-label="https://stackoverflow.com/questions/64308461/fail-to-load-a-wasm-file-in-a-web-application" class="external-link" href="https://stackoverflow.com/questions/64308461/fail-to-load-a-wasm-file-in-a-web-application">Turns out</a>, I should be running <code>wasm-pack</code> with <code>--target</code> set to <code>web</code> or <code>no-modules</code>.</p>
        <p dir="auto">The next challange is adding the font. Typst (as far as I can tell) doesn't allow importing fonts from files, all fonts should be added to the <code>World</code>. What I want to do is tell the compiler that I have <em>all</em> the fonts from fontsource and then download them on-demand. To do that, I'll ask their API for the list of all fonts and then load them from the CDN via the <code>reqwest</code> crate.</p>
        <p dir="auto">I was going to use <code>reqwest</code> instead of direct <code>fetch</code> calls because it's already type-safe, or so I thought. It requires an async executer, which I couldn't figure out how to put there. Okay, the dynamic loading of fonts is in itself a large-ish project which I don't have the time for right now. I'll settle on embedding JetBrains Mono into the library for now.</p>
        <h2 data-heading="Sending emails" dir="auto">Sending emails</h2>
        <p dir="auto">The most popular library for connecting to external mail servers from the client seems to be <code>smtp.js</code>. It is <a data-tooltip-position="top" aria-label="https://www.smtpjs.com/" class="external-link" href="https://www.smtpjs.com/">dead</a> now. The next option is nodemailer which is actually on GitHub, so it's less likely to die. But that library relies on the <code>net</code> module instead of the a browser api, so it's a no-go too.</p>
        <p dir="auto">After an hour of looking for a solution I've found none and I'm beginning to unredstand why. SMTP is not HTTP. SMTP is not WebSocket. SMTP is a protocol that browsers don't support natively, which means that what smtp.js was doing is it was sending requests through their server. This also means that if <em>I</em> want to send e-mails from the client I have to have a server or a desktop agent.</p>
        <p dir="auto">Sidenote: LLMs are useless for research. I've already read through everything it was giving me and more on my own, and convincing it that <code>smtp.js</code> was actually down took 2 attempts.</p>
        <h2 data-heading="2 months later: what happened?" dir="auto">2 months later: what happened?</h2>
        <p dir="auto">Since I only had <a data-href="2-hours" href="/2-hours" class="internal-link">2-hours</a> to finish the email part, I've dropped my own server, see <a data-href="setting-up-api" href="/setting-up-api" class="internal-link">setting-up-api</a> for more on that. <a data-href="mk-api" href="/mk-api" class="internal-link">mk-api</a> was created with a different purpose (initially, at least).</p>
        <p dir="auto">When I eventually get back to <a data-href="cert" href="/cert" class="internal-link">cert</a>, the updates are going in <a data-href="revive-cert" href="/revive-cert" class="internal-link">revive-cert</a>.</p>
    </main>
    <script type="module" src="/client.js"></script>
</body>

</html>