---
tags:
  - project
  - archive
created: 2025-11-14
updated: 2026-01-24T14:27:49+03:00
up: "[devlog](/devlog)"
post: "[snlx.net](/snlx.net)"
layout: base.njk
---

![hello-world.svg](/hello-world.svg)

Наш университет готовится к олимпиаде по математике. Нужно будет раздать всем участникам сертификаты, для этого необходим инструмент, который примет шаблон, впишет имена и сохранит как PDF. Меня попросили порекомендовать программу для этих целей. Конечно, можно было просто использовать libreoffice, но вбивать каждое имя вручную и пересохранять документ по 500 раз это долго. Решил сделать простую утилиту, которая принимает список имён и шаблон, генерирует сертификаты и экспортирует их как один документ для печати и как отдельные файлы для отправки на почту.

Это достаточно простой проект, поэтому он даёт возможность заодно поработать и над этим сайтом, т.к. стили будут общими. На сайте я не хочу держать растровые изображения, поэтому постараюсь использовать исключительно SVG.

## Компоновка генератора сертификатов
Для начала я набросал интерфейс на бумаге. Поскольку растровые изображения я грузить не буду, вот excalidraw версия вместо фотографии:
![cert excalidraw](/cert-excalidraw.light.svg)

Начал думать насчёт использования React или Lustre, но остановился на том, что проект слишком простой, чтобы они были полезны.

Квадрат в левом нижнем углу картинки - место под логотип универа (у нас их 2, я возьму более новый / более простой). Написал SVG вручную по точкам, чтобы его могла стилизовать сама страница, это достаточно несложно, можете посмотреть исходник.

После того, как реально это сверстал, решил поменять местами список имён и настройки, так что итоговое приложение является отражением макета, приведённого выше.

## Выбор шаблона
Предпросмотр каждой страницы планировал делать как `<image>`, а этот тэг не поддерживает PDF исходники. Нашёл [простую библиотеку](https://github.com/iqbal-rashed/pdftoimg-js), которая конвертирует PDF в картинку.

## Как генерировать предпросмотр
Рендерить каждую страницу на каждое изменение чего угодно - бесполезная трата ресурсов, поэтому решил использовать CSS переменные для картинки и расположения надписи.

[Комментарий на StackOverflow](https://stackoverflow.com/questions/2182716/is-it-possible-to-set-a-src-attribute-of-an-img-tag-in-css) указывает на то, что задание исходника картинки через CSS могло не работать в Firefox, но сейчас вроде всё нормально. Можно было использовать свойство `background-image` на диве, но тогда за расчёт соотношения сторон этого самого дива отвечал бы JS.

## Выравнивание текста
Элемент был `position: absolute`. Я поставил `text-align: center` и, конечно, это не сработало. Это можно решить несколькими путями. Вначале попробовал поместить текст со свойством `text-anchor` в SVG overlay, но в таком случае через CSS нельзя задать его `x` и `y`. Другой вариант: можно задать `transform: translate` на элементе (не использовать SVG) и забыть про эту проблему.

Ну как забыть... Выравнивание-то работает, но зум / печать ломает размер текста. Возвращаемся к SVG.

SVG элементы поддерживают обычные свойства `position: absolute` и `top`, `left`, `right`, `bottom`, так что проблема с `x` и `y`, которые нельзя задать в стилях, решена.

Но для того, чтобы это было хоть сколько-то полезно, нужен viewBox, а для него нужно получить размеры изображения, т.е. всё-таки делать это через JS. Ну ладно. Но это тоже не работает, я так и не понял, почему, но выглядит так, что если `font-size` берётся из переменной, браузер использует пиксели HTML вместо пикселей SVG.

Рабочим вариантом оказалось использование container-query.

## Печать
CSS даёт настраивать стили для печати в `@media print`.

А вот сохранение нескольких файлов последовательно - это уже проблема. В двух словах, браузер не даёт печатать без диалога, а печать - единственный нормальный способ сохранить несколько PDF файлов из JS. Внешние библиотеки для экспорта PDF не умеют обрабатывать изображения, src которых задан как object URI в стилях. Честно говоря, вполне ожидаемо. Когда Вы последний раз видели изображение, src которого задано как object URI в CSS?

Другой вариант - подключить компилятор typst и заставить его генерить PDF.

## Обратная связь от пользователя
1. Я переключал язык, если `navigator.language === "ru"`, а на винде он `"ru-RU"`. Починил
2. Попросили использовать JetBrains Mono как шрифт по умолчанию
3. Поле ввода имени должно принимать ещё и e-mail'ы, чтобы было понятно, куда отправлять сгенерированные сертификаты
4. В идеале должна быть кнопка отправки

Последний пункт - самый интересный. Я раньше не работал с e-mail, поэтому на этих выходных буду разбираться.

## Что доделать на сайте
В следующей заметке я сделаю ссылку на эту, так что сайт должен уметь отображать входящие ссылки.